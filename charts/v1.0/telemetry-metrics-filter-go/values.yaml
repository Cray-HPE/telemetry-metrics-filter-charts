---
global:
  appVersion: 2.22.0-20221109214228.54f93bc

image:
  repository: artifactory.algol60.net/csm-docker/unstable/hms-hmcollector
  pullPolicy: IfNotPresent

cray-service:
  type: "Deployment"
  nameOverride: "telemetry-metrics-filter-go"
  fullnameOverride: "telemetry-metrics-filter-go"
  replicaCount: 3
  podAnnotations:
    traffic.sidecar.istio.io/excludeOutboundPorts: "8082,9092,2181"
  strategy:
    rollingUpdate:
      maxUnavailable: 50%
    type: RollingUpdate
  containers:
    telemetry-metrics-filter:
      name: "telemetry-metrics-filter"
      image:
        repository: artifactory.algol60.net/csm-docker/unstable/hms-hmcollector
#      ports:
#        - name: http
#          containerPort: 9088 #uncomment this to expose the port. not needed right now
      env:
        - name: LOG_LEVEL
          value: INFO
        - name: WORKER_COUNT
          value: 10
        - name: HTTP_LISTEN
          value: 0.0.0.0:9088
        - name: BROKER_CONFIG_FILE
          value: /usr/local/etc/service/telemetry-filter-broker-config.json

#      livenessProbe:
#        httpGet:
#          port: 9088
#          path: /metrics
#        initialDelaySeconds: 10
#        periodSeconds: 20
#      readinessProbe:
#        httpGet:
#          port: 27777
#          path: /capmc/v1/readiness
#        initialDelaySeconds: 5
#        periodSeconds: 60
      resources:
        limits:
          cpu: "10"
          memory: 2Gi
        requests:
          cpu: "4"
          memory: 128Mi
      volumeMounts:
        - name: telemetry-config-vol
          mountPath: /usr/local/etc/service/telemetry-filter-broker-config.json
          readOnly: true
          subPath: telemetry-filter-broker-config.json

  volumes:
    telemetry-config-vol:
      name: telemetry-config-vol
      configMap:
        name: telemetry-metrics-filter-topics-go